{
  "keywords": {
    "coordinate_system": {
      "description": "Coordinate system type: 'cartesian' or 'polar'",
      "values": ["cartesian", "polar"],
      "example": "coordinate_system: polar"
    },
    "variables": {
      "description": "User-defined variables for use in jz/mu_r formulas. Values can be numbers or formulas (quotes optional). Variables can reference previously defined variables using $varname syntax. Reserved names: step, H, dx, dy, dr, dtheta, N, A, pi, e",
      "acceptsAnyChild": true,
      "example": "variables:\n  freq: 60\n  omega: 2*pi*freq  # Can reference $freq\n  rpm: freq/60      # Quotes optional for formulas"
    },
    "mesh": {
      "description": "Mesh configuration for Cartesian coordinates",
      "children": ["dx", "dy"]
    },
    "dx": {
      "description": "Grid spacing in x-direction [m]",
      "type": "number",
      "example": "dx: 0.2e-3"
    },
    "dy": {
      "description": "Grid spacing in y-direction [m]",
      "type": "number",
      "example": "dy: 0.2e-3"
    },
    "polar_domain": {
      "description": "Polar coordinate domain configuration",
      "children": ["r_start", "r_end", "r_orientation", "theta_range"]
    },
    "r_start": {
      "description": "Inner radius [m], must satisfy 0 < r_start < r_end",
      "type": "number",
      "example": "r_start: 0.222"
    },
    "r_end": {
      "description": "Outer radius [m]",
      "type": "number",
      "example": "r_end: 0.278"
    },
    "r_orientation": {
      "description": "Radial direction orientation: 'horizontal' or 'vertical'",
      "values": ["horizontal", "vertical"],
      "example": "r_orientation: horizontal"
    },
    "theta_range": {
      "description": "Angular range [rad], typically π/n for n-pole sector models",
      "type": "number",
      "example": "theta_range: 1.0471975512  # π/3 for 3-pole sector"
    },
    "polar_boundary_conditions": {
      "description": "Boundary conditions for polar coordinates (radial: inner/outer, angular: theta_min/theta_max)",
      "children": ["inner", "outer", "theta_min", "theta_max"]
    },
    "inner": {
      "description": "Inner boundary condition (at r=r_start)",
      "children": ["type", "value", "alpha", "beta", "gamma"]
    },
    "outer": {
      "description": "Outer boundary condition (at r=r_end)",
      "children": ["type", "value", "alpha", "beta", "gamma"]
    },
    "theta_min": {
      "description": "Boundary condition at θ=0 (angular start boundary)",
      "children": ["type", "value", "alpha", "beta", "gamma"]
    },
    "theta_max": {
      "description": "Boundary condition at θ=theta_range (angular end boundary)",
      "children": ["type", "value", "alpha", "beta", "gamma"]
    },
    "type": {
      "description": "Boundary condition type: 'dirichlet', 'neumann', 'periodic', or 'robin'. For periodic BC with value<0, anti-periodic BC is applied (f(θ=0) = -f(θ=θ_range))",
      "values": ["dirichlet", "neumann", "periodic", "robin"],
      "example": "type: dirichlet"
    },
    "value": {
      "description": "Boundary condition value. For Dirichlet: fixed Az value. For Neumann: normal derivative. For periodic: >=0 normal periodic, <0 anti-periodic",
      "type": "number",
      "example": "value: 0.0"
    },
    "alpha": {
      "description": "Robin BC: coefficient for Az term (α·Az + β·∂Az/∂n = γ). Default: 1.0 (Dirichlet-like when β=0)",
      "type": "number",
      "example": "alpha: 1.0",
      "validParents": ["left", "right", "top", "bottom", "inner", "outer", "theta_min", "theta_max"]
    },
    "gamma": {
      "description": "Robin BC: right-hand side value (α·Az + β·∂Az/∂n = γ). Default: 0.0",
      "type": "number",
      "example": "gamma: 0.0",
      "validParents": ["left", "right", "top", "bottom", "inner", "outer", "theta_min", "theta_max"]
    },
    "boundary_conditions": {
      "description": "Boundary conditions for Cartesian coordinates (4 edges)",
      "children": ["left", "right", "top", "bottom"]
    },
    "left": {
      "description": "Left boundary condition",
      "children": ["type", "value", "alpha", "beta", "gamma"]
    },
    "right": {
      "description": "Right boundary condition",
      "children": ["type", "value", "alpha", "beta", "gamma"]
    },
    "top": {
      "description": "Top boundary condition",
      "children": ["type", "value", "alpha", "beta", "gamma"]
    },
    "bottom": {
      "description": "Bottom boundary condition",
      "children": ["type", "value", "alpha", "beta", "gamma"]
    },
    "materials": {
      "description": "Material definitions (any material name is allowed)",
      "acceptsAnyChild": true,
      "childrenProperties": ["rgb", "mu_r", "jz", "calc_force", "anti_aliasing", "coarsen", "coarsen_ratio", "preset"]
    },
    "rgb": {
      "description": "RGB color for material identification in input image [R, G, B]",
      "type": "array",
      "example": "rgb: [255, 255, 255]",
      "validParents": ["materials"]
    },
    "mu_r": {
      "description": "Relative permeability (dimensionless). Supports: constant, formula (quotes optional, with $H, $dx/$dy for Cartesian, $dr/$dtheta for polar, and user-defined $variables), or table [[H_values], [mu_r_values]]",
      "type": "number|string|array",
      "example": "mu_r: 1.0",
      "validParents": ["materials"]
    },
    "jz": {
      "description": "Current density [A/m²]. Supports: constant, formula (quotes optional), or array. Formula variables: $step, $dx/$dy (Cartesian), $dr/$dtheta (polar), $N (pixel count), $A (area [m²]), and user-defined $variables",
      "type": "number|string|array",
      "example": "jz: 1.0e9",
      "validParents": ["materials"]
    },
    "calc_force": {
      "description": "Calculate Maxwell stress force on this material (true/false)",
      "type": "boolean",
      "example": "calc_force: true",
      "validParents": ["materials"]
    },
    "anti_aliasing": {
      "description": "Enable anti-aliasing interpolation for gradient pixels at material boundaries. Uses harmonic mean of μ based on RGB distance ratio",
      "type": "boolean",
      "example": "anti_aliasing: true",
      "validParents": ["materials"]
    },
    "coarsen": {
      "description": "Enable adaptive mesh coarsening for this material region (reduces mesh resolution in uniform areas)",
      "type": "boolean",
      "example": "coarsen: true",
      "validParents": ["materials"]
    },
    "coarsen_ratio": {
      "description": "Coarsening ratio (e.g., 4 means 4x4 pixels → 1 cell). Only used when coarsen: true",
      "type": "integer",
      "example": "coarsen_ratio: 4",
      "validParents": ["materials"]
    },
    "preset": {
      "description": "Reference to a material preset defined in material_presets section",
      "type": "string",
      "example": "preset: my_steel",
      "validParents": ["materials"]
    },
    "material_presets": {
      "description": "User-defined material presets for reuse. Define B-H curves or formulas once, reference by name",
      "acceptsAnyChild": true,
      "childrenProperties": ["mu_r"],
      "example": "material_presets:\n  my_steel:\n    mu_r: [[0, 100, 500], [5000, 4500, 3000]]"
    },
    "flux_linkage": {
      "description": "Flux linkage calculation paths. Each path defines start/end points for Φ = Az(end) - Az(start)",
      "type": "array",
      "example": "flux_linkage:\n  - name: coil_A\n    start: [0.01, 0.05]\n    end: [0.01, 0.15]"
    },
    "name": {
      "description": "Name identifier for flux linkage path",
      "type": "string",
      "example": "name: coil_A",
      "validParents": ["flux_linkage"]
    },
    "start": {
      "description": "Start point coordinates [x, y] in physical units [m] for flux linkage calculation",
      "type": "array",
      "example": "start: [0.01, 0.05]",
      "validParents": ["flux_linkage"]
    },
    "end": {
      "description": "End point coordinates [x, y] in physical units [m] for flux linkage calculation",
      "type": "array",
      "example": "end: [0.01, 0.15]",
      "validParents": ["flux_linkage"]
    },
    "transient": {
      "description": "Transient analysis configuration",
      "children": ["enabled", "enable_sliding", "total_steps", "slide_direction", "slide_region_start", "slide_region_end", "slide_pixels_per_step"]
    },
    "enabled": {
      "description": "Enable feature (true/false)",
      "type": "boolean",
      "example": "enabled: true",
      "validParents": ["transient", "nonlinear_solver", "anderson"]
    },
    "enable_sliding": {
      "description": "Enable image sliding for rotor motion simulation (true/false)",
      "type": "boolean",
      "example": "enable_sliding: true"
    },
    "total_steps": {
      "description": "Number of analysis steps",
      "type": "integer",
      "example": "total_steps: 167"
    },
    "slide_direction": {
      "description": "Sliding direction: 'vertical' or 'horizontal'",
      "values": ["vertical", "horizontal"],
      "example": "slide_direction: vertical"
    },
    "slide_region_start": {
      "description": "Start position of sliding region [pixels]",
      "type": "integer",
      "example": "slide_region_start: 110"
    },
    "slide_region_end": {
      "description": "End position of sliding region [pixels]",
      "type": "integer",
      "example": "slide_region_end: 390"
    },
    "slide_pixels_per_step": {
      "description": "Movement per step [pixels] (circular shift amount)",
      "type": "integer",
      "example": "slide_pixels_per_step: 1"
    },
    "nonlinear_solver": {
      "description": "Nonlinear solver configuration for materials with field-dependent permeability μ(H)",
      "children": ["enabled", "solver_type", "max_iterations", "tolerance", "relaxation", "anderson", "gmres_restart", "line_search_c", "line_search_alpha_init", "line_search_alpha_min", "line_search_rho", "line_search_max_trials", "line_search_adaptive", "verbose", "export_convergence"]
    },
    "solver_type": {
      "description": "Nonlinear solver algorithm: 'picard' (simple fixed-point) or 'newton-krylov' (recommended for fast convergence)",
      "values": ["picard", "newton-krylov"],
      "example": "solver_type: newton-krylov",
      "validParents": ["nonlinear_solver"]
    },
    "anderson": {
      "description": "Anderson acceleration settings (works with both picard and newton-krylov solvers)",
      "children": ["enabled", "depth", "beta"],
      "validParents": ["nonlinear_solver"]
    },
    "depth": {
      "description": "Anderson acceleration history depth (typically 3-10, larger = more acceleration but more memory)",
      "type": "integer",
      "example": "depth: 5",
      "validParents": ["anderson"]
    },
    "beta": {
      "description": "Anderson: mixing parameter (0.0-1.0, 1.0 = full Anderson). Robin BC: coefficient for ∂Az/∂n term (α·Az + β·∂Az/∂n = γ), set >0 for external reluctance",
      "type": "number",
      "example": "beta: 1.0",
      "validParents": ["anderson", "left", "right", "top", "bottom", "inner", "outer", "theta_min", "theta_max"]
    },
    "max_iterations": {
      "description": "Maximum number of nonlinear iterations",
      "type": "integer",
      "example": "max_iterations: 50",
      "validParents": ["nonlinear_solver"]
    },
    "tolerance": {
      "description": "Convergence tolerance (relative residual norm)",
      "type": "number",
      "example": "tolerance: 1.0e-5",
      "validParents": ["nonlinear_solver"]
    },
    "relaxation": {
      "description": "Relaxation factor for Picard/Anderson methods (0.5 ~ 0.8, lower = more stable)",
      "type": "number",
      "example": "relaxation: 0.7",
      "validParents": ["nonlinear_solver"]
    },
    "gmres_restart": {
      "description": "GMRES restart parameter for Krylov subspace (Newton-Krylov only, typically 30)",
      "type": "integer",
      "example": "gmres_restart: 30",
      "validParents": ["nonlinear_solver"]
    },
    "line_search_c": {
      "description": "Armijo parameter for sufficient decrease condition (Newton-Krylov only, typically 1e-4)",
      "type": "number",
      "example": "line_search_c: 1.0e-4",
      "validParents": ["nonlinear_solver"]
    },
    "line_search_alpha_init": {
      "description": "Initial step length (Newton-Krylov only, 1.0 = full Newton step)",
      "type": "number",
      "example": "line_search_alpha_init: 1.0",
      "validParents": ["nonlinear_solver"]
    },
    "line_search_alpha_min": {
      "description": "Minimum step length safety bound (Newton-Krylov only)",
      "type": "number",
      "example": "line_search_alpha_min: 1.0e-4",
      "validParents": ["nonlinear_solver"]
    },
    "line_search_rho": {
      "description": "Backtracking factor (Newton-Krylov only, 0 < rho < 1, default 0.5, higher = more aggressive)",
      "type": "number",
      "example": "line_search_rho: 0.5",
      "validParents": ["nonlinear_solver"]
    },
    "line_search_max_trials": {
      "description": "Maximum number of backtracking trials (Newton-Krylov only)",
      "type": "integer",
      "example": "line_search_max_trials: 100",
      "validParents": ["nonlinear_solver"]
    },
    "line_search_adaptive": {
      "description": "Enable adaptive initial step length (Newton-Krylov only, recommended for better convergence)",
      "type": "boolean",
      "example": "line_search_adaptive: true",
      "validParents": ["nonlinear_solver"]
    },
    "verbose": {
      "description": "Print detailed solver iteration information (true/false)",
      "type": "boolean",
      "example": "verbose: false",
      "validParents": ["nonlinear_solver"]
    },
    "export_convergence": {
      "description": "Export convergence history to CSV file (true/false)",
      "type": "boolean",
      "example": "export_convergence: true",
      "validParents": ["nonlinear_solver"]
    }
  },
  "snippets": {
    "boundary_dirichlet": {
      "name": "Dirichlet Boundary (value=0)",
      "trigger": "type",
      "snippet": "type: dirichlet\nvalue: 0.0"
    },
    "boundary_neumann": {
      "name": "Neumann Boundary (value=0)",
      "trigger": "type",
      "snippet": "type: neumann\nvalue: 0.0"
    },
    "boundary_periodic": {
      "name": "Periodic Boundary",
      "trigger": "type",
      "snippet": "type: periodic\nvalue: 0.0"
    },
    "boundary_antiperiodic": {
      "name": "Anti-Periodic Boundary (f(θ=0) = -f(θ=θ_range))",
      "trigger": "type",
      "snippet": "type: periodic\nvalue: -1.0"
    },
    "boundary_robin": {
      "name": "Robin Boundary (α·Az + β·∂Az/∂n = γ)",
      "trigger": "type",
      "snippet": "type: robin\nalpha: 1.0\nbeta: 0.001\ngamma: 0.0"
    },
    "theta_min_periodic": {
      "name": "θ_min Periodic Boundary",
      "trigger": "theta_min",
      "snippet": "theta_min:\n  type: periodic\n  value: 0.0"
    },
    "theta_min_antiperiodic": {
      "name": "θ_min Anti-Periodic Boundary",
      "trigger": "theta_min",
      "snippet": "theta_min:\n  type: periodic\n  value: -1.0"
    },
    "theta_min_dirichlet": {
      "name": "θ_min Dirichlet Boundary",
      "trigger": "theta_min",
      "snippet": "theta_min:\n  type: dirichlet\n  value: 0.0"
    },
    "theta_max_periodic": {
      "name": "θ_max Periodic Boundary",
      "trigger": "theta_max",
      "snippet": "theta_max:\n  type: periodic\n  value: 0.0"
    },
    "theta_max_antiperiodic": {
      "name": "θ_max Anti-Periodic Boundary",
      "trigger": "theta_max",
      "snippet": "theta_max:\n  type: periodic\n  value: -1.0"
    },
    "theta_max_dirichlet": {
      "name": "θ_max Dirichlet Boundary",
      "trigger": "theta_max",
      "snippet": "theta_max:\n  type: dirichlet\n  value: 0.0"
    },
    "material_template": {
      "name": "Material Definition Template",
      "trigger": "material",
      "snippet": "rgb: [255, 255, 255]\nmu_r: 1.0\njz: 0.0\ncalc_force: false"
    },
    "material_with_antialias": {
      "name": "Material with Anti-aliasing",
      "trigger": "material",
      "snippet": "rgb: [128, 128, 128]\nmu_r: 1000.0\njz: 0.0\nanti_aliasing: true"
    },
    "material_with_coarsening": {
      "name": "Material with Adaptive Mesh Coarsening",
      "trigger": "material",
      "snippet": "rgb: [255, 255, 255]\nmu_r: 1.0\njz: 0.0\ncoarsen: true\ncoarsen_ratio: 4"
    },
    "material_from_preset": {
      "name": "Material from Preset",
      "trigger": "material",
      "snippet": "rgb: [128, 128, 128]\npreset: my_steel\njz: 0.0"
    },
    "material_presets_template": {
      "name": "Material Presets Section",
      "trigger": "material_presets",
      "snippet": "my_steel:\n  mu_r: [[0, 100, 500, 1000], [5000, 4500, 3000, 2000]]\nmy_formula:\n  mu_r: \"5000 / (1 + ($H/500)^2)\""
    },
    "flux_linkage_template": {
      "name": "Flux Linkage Paths",
      "trigger": "flux_linkage",
      "snippet": "- name: coil_A\n  start: [0.01, 0.05]\n  end: [0.01, 0.15]\n- name: coil_B\n  start: [0.02, 0.05]\n  end: [0.02, 0.15]"
    },
    "transient_template": {
      "name": "Transient Analysis Template",
      "trigger": "transient",
      "snippet": "enabled: true\nenable_sliding: true\ntotal_steps: 1\nslide_direction: vertical\nslide_region_start: 0\nslide_region_end: 1\nslide_pixels_per_step: 1"
    },
    "nonlinear_picard": {
      "name": "Nonlinear Solver - Picard Method",
      "trigger": "nonlinear_solver",
      "snippet": "enabled: true\nsolver_type: picard\nmax_iterations: 50\ntolerance: 1.0e-5\nrelaxation: 0.7\nverbose: false\nexport_convergence: true"
    },
    "nonlinear_picard_anderson": {
      "name": "Nonlinear Solver - Picard with Anderson Acceleration",
      "trigger": "nonlinear_solver",
      "snippet": "enabled: true\nsolver_type: picard\nmax_iterations: 50\ntolerance: 1.0e-5\nrelaxation: 0.7\nanderson:\n  enabled: true\n  depth: 5\n  beta: 1.0\nverbose: false\nexport_convergence: true"
    },
    "nonlinear_newton_krylov": {
      "name": "Nonlinear Solver - Newton-Krylov",
      "trigger": "nonlinear_solver",
      "snippet": "enabled: true\nsolver_type: newton-krylov\nmax_iterations: 50\ntolerance: 1.0e-5\ngmres_restart: 30\nline_search_c: 1.0e-4\nline_search_alpha_init: 1.0\nline_search_alpha_min: 1.0e-4\nline_search_rho: 0.5\nline_search_max_trials: 100\nline_search_adaptive: true\nverbose: false\nexport_convergence: true"
    },
    "nonlinear_newton_krylov_anderson": {
      "name": "Nonlinear Solver - Newton-Krylov + Anderson (Recommended)",
      "trigger": "nonlinear_solver",
      "snippet": "enabled: true\nsolver_type: newton-krylov\nmax_iterations: 50\ntolerance: 1.0e-5\ngmres_restart: 30\nanderson:\n  enabled: true\n  depth: 5\n  beta: 0.3\nline_search_c: 1.0e-4\nline_search_alpha_init: 1.0\nline_search_alpha_min: 1.0e-4\nline_search_rho: 0.5\nline_search_max_trials: 100\nline_search_adaptive: true\nverbose: false\nexport_convergence: true"
    }
  },
  "templates": {
    "polar_2d_motor": {
      "name": "Polar 2D Motor Analysis",
      "description": "Template for 2D motor analysis in polar coordinates",
      "content": "coordinate_system: polar\n\nmesh:\n  dx: 0.2e-3\n  dy: 0.2e-3\n\npolar_domain:\n  r_start: 0.222\n  r_end: 0.278\n  r_orientation: horizontal\n  theta_range: 1.0471975512  # π/3\n\npolar_boundary_conditions:\n  inner:\n    type: dirichlet\n    value: 0.0\n  outer:\n    type: dirichlet\n    value: 0.0\n  theta_min:\n    type: periodic\n    value: 0.0  # Use value: -1.0 for anti-periodic BC\n  theta_max:\n    type: periodic\n    value: 0.0  # Use value: -1.0 for anti-periodic BC\n\nmaterials:\n  air:\n    rgb: [255, 255, 255]\n    mu_r: 1.0\n    jz: 0.0\n\n  iron_stator:\n    rgb: [128, 128, 128]\n    mu_r: 100.0\n    jz: 0.0\n    calc_force: false\n\n  iron_rotor:\n    rgb: [100, 100, 100]\n    mu_r: 500.0\n    jz: 0.0\n    calc_force: true\n\ntransient:\n  enabled: true\n  enable_sliding: true\n  total_steps: 167\n  slide_direction: vertical\n  slide_region_start: 110\n  slide_region_end: 390\n"
    }
  }
}
