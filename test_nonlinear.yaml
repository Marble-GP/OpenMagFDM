# Test configuration for nonlinear materials
# Simple 2D test case with saturation

coordinate_system: cartesian

# Mesh settings
mesh:
  dx: 1.0e-3  # 1 mm
  dy: 1.0e-3  # 1 mm

# Boundary conditions
boundary_conditions:
  left:
    type: dirichlet
    value: 0.0
  right:
    type: dirichlet
    value: 0.0
  bottom:
    type: dirichlet
    value: 0.0
  top:
    type: dirichlet
    value: 0.0

# Materials with nonlinear mu_r
materials:
  air:
    rgb: [255, 255, 255]
    mu_r: 1.0
    jz: 0.0
    calc_force: false

  # Coil with high current density
  coil:
    rgb: [255, 0, 0]
    mu_r: 1.0
    jz: 1.0e6  # 1 MA/m^2
    calc_force: false

  # Nonlinear magnetic core (saturation formula)
  core_nonlinear:
    rgb: [128, 128, 128]
    mu_r: 1 + 4999 * exp(-$H*$H / 2 / 1e8)  # μ_r: 5000 at H=0, → 1 at high H
    jz: 0.0
    calc_force: true

# Nonlinear solver configuration
nonlinear_solver:
  enabled: true
  solver_type: newton-krylov  # Options: "picard", "anderson", "newton-krylov"
  max_iterations: 50
  tolerance: 1.0e-5
  gmres_restart: 30  # GMRES restart parameter (for future Jacobian-free implementation)

  # Line search parameters (for Newton-Krylov)
  line_search_c: 1.0e-4           # Armijo parameter (sufficient decrease condition)
  line_search_alpha_init: 1.0     # Initial step length (default: 1.0 = full Newton step)
  line_search_alpha_min: 1.0e-4   # Minimum step length (safety lower bound)
  line_search_rho: 0.5            # Backtracking factor (0 < rho < 1, default: 0.5, higher = more aggressive)
  line_search_max_trials: 100      # Maximum backtracking trials
  line_search_adaptive: true      # Enable adaptive initial step length (recommended)

  verbose: false
  export_convergence: true

# No transient analysis for this test
transient:
  enabled: false
